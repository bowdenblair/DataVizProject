<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Team Data Farce</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>

	<style type="text/css">



		body {
			background-color: white;
		}

		svg {
			background-color: gray;
		}



	</style>
</head>
<body>
	<script type="text/javascript">
        //took the basic mercator projection demo and modified it.


		//Width and height
		var w = 800;
		var h = 600;

		//zoom
		var zoom = d3.zoom()
                .scaleExtent([1, 250])
                .on("zoom", zooming);

		//Define map projection
		var projection = d3.geoMercator()
							   .center([ 0, 0 ])
							   .translate([ 1100, 650 ])
							   .scale([ w/2.3]);

		//Define path generator
		var path = d3.geoPath()
						 .projection(projection);
        
		//Create SVG
		var svg = d3.select("body")
					.append("svg")
					.attr("width", w)
					.attr("height", h)
					.call(zoom);

       
       //put the original colors into a scaling website //https://gka.github.io/palettes/#colors="#fffac2","#fecc5c","#fd8d3c","#f04420","#b00026"|steps=20|bez=1|coL=1
        var color = d3.scaleQuantize()
    .range(['#fffac2','#ffefab','#ffe397','#ffd883','#ffcb72','#ffbe63','#ffb255','#ffa44a','#fe9741','#fc883a','#f97b35','#f46f30','#ef622d','#e8542a','#e04928','#d83c27','#cf2f26','#c52326','#ba1426','#b00026']);
        
        d3.csv("counts.csv", function(d){
            d3.csv("statePop.csv", function(popData){
                    //var c = d3.nest().key(function(d){ return d.state; }).distinct(objects);

                    //Load in GeoJSON data
                      d3.json("us.json", function(json) {
                          for(var i = 0; i < d.length; i++){
                              var state = d[i].state;
                              for(var j = 0; j < popData.length; j++){
                                  var popState = popData[j].Geography;
                                  var pop = popData[j].Population;
                                  
                                  if(state == popState){
                                      d[j].population = pop;
                                      break;
                                  }
                              }
                          }
                          
                    //Set input domain for color scale
                    color.domain([
                        d3.min(d, function(d) { return d.population/d.count; }), 
                        d3.max(d, function(d) { return d.population/d.count; })
                    ]);
                          
                          console.log(color.domain());                          

                          for(var i=0; i<d.length; i++){
                              var state = d[i].state;
                              var count = d[i].count;
                              var pop = d[i].population;
                              
                              for(var k=0; k<json.features.length; k++){
                                  var jsonState = json.features[k].properties.NAME;

                                  if(state == jsonState){
                                      json.features[k].properties.count = count;
                                      json.features[k].properties.population = pop;
                                      break;
                                  }
                              }
                          }

                          //Bind data and create one path per GeoJSON feature
                         svg.selectAll("path")
                             .data(json.features)
                             .enter()
                             .append("path")
                             .attr("d", path)
                             .style("fill", function(d) {

                                //Get data value
                                var value = d.properties.count; 

                                if (value) {
                                    //If value exists…
                                    return color(value);
                                } else {
                                    //If value is undefined…
                                    return "#ccc";
                                }

                            }).on("mouseover", function(d, popData){
                                return tooltip.transition().duration(500).style("opacity", 1.0).text(d.properties.NAME + ", police killings: " + d.properties.count + ", pop: " + d.properties.population);
                            })
                            .on("mousemove", function(d){
                                return tooltip.style("top", event.pageY+20+"px").style("left",(event.pageX-10)+"px");
                            })
                            .on("mouseout", function(d){
                                return tooltip.transition().duration(500)
                            .style("opacity", 0);
                            });

                            var tooltip = d3.select("body")
                                .append("div")
                                .style("position", "absolute")
                                .style("font-family", "'Open Sans', sans-serif")
                                .style("font-size", "14px")
                                .style("z-index", "10")
                                .style("opacity", 0);
                });
            });
        });

		function zooming() 
        {
            console.log("zooming");
            svg.attr("transform", d3.event.transform);
        }




	
	</script>
    <!-- <p>I took data from The guardians collection of police killing data called <a href = 'https://www.theguardian.com/us-news/ng-interactive/2015/jun/01/the-counted-police-killings-us-database'>"The Counted"</a> I decided to only use the 2016 data. I then used openrefine to get the counts of police killings in each state. I used the basic mercator projection demo and a map of the US separated by state to output that data with an expanded color range from <a href='https://gka.github.io/palettes/#colors="#fffac2","#fecc5c","#fd8d3c","#f04420","#b00026"|steps=20|bez=1|coL=1"'>this</a> website. I had to expand the color range because of the massive range of state values 1 from a number of states to 161 from CA. I used the chloropleth demo as a guide for how to do this. I made tooltips appear over each state displaying the count and the state's name. </p> -->
</body>
</html>